# üîó Integraci√≥n API-Storybook-Swagger

Esta secci√≥n documenta la integraci√≥n completa entre las rutas del frontend, componentes de Storybook y endpoints de la API backend, proporcionando una experiencia de desarrollo unificada.

## üéØ Objetivo

Crear un mapeo claro y accesible que permita a los desarrolladores:

- **Navegar r√°pidamente** entre frontend y backend
- **Encontrar componentes reutilizables** en Storybook
- **Entender los endpoints de API** disponibles en Swagger
- **Mantener consistencia** en el desarrollo

## üìä Enlaces R√°pidos

| Herramienta        | URL Local                                           | Descripci√≥n                                 |
| ------------------ | --------------------------------------------------- | ------------------------------------------- |
| üé® **Storybook**   | [localhost:6006](http://localhost:6006)             | Documentaci√≥n interactiva de componentes UI |
| üì° **Swagger API** | [localhost:8000/docs](http://localhost:8000/docs)   | Documentaci√≥n completa de endpoints REST    |
| üîß **ReDoc API**   | [localhost:8000/redoc](http://localhost:8000/redoc) | Vista alternativa y elegante de la API      |
| üìñ **Docusaurus**  | [localhost:3000](http://localhost:3000)             | Esta documentaci√≥n t√©cnica                  |

## üó∫Ô∏è Mapeo Interactivo

import ApiIntegrationTable from '@site/src/components/ApiIntegrationTable';

<ApiIntegrationTable />

## üõ†Ô∏è C√≥mo usar esta documentaci√≥n

### Para Desarrolladores Frontend

1. **Antes de crear un componente nuevo:**

   - Busca en Storybook si ya existe algo similar
   - Revisa los patrones de dise√±o establecidos
   - Consulta la tabla de integraci√≥n para ver ejemplos de uso

2. **Al trabajar en una ruta:**

   - Identifica qu√© endpoints necesitas en la tabla
   - Verifica la documentaci√≥n de Swagger para entender los schemas
   - Usa componentes existentes de Storybook cuando sea posible

3. **Para mantener consistencia:**
   - Sigue los patrones establecidos en otras rutas similares
   - Usa los mismos componentes base para elementos comunes
   - Mant√©n la nomenclatura consistente con el resto del proyecto

### Para Desarrolladores Backend

1. **Al crear nuevos endpoints:**

   - Documenta claramente en Swagger con ejemplos
   - Usa nomenclatura consistente con endpoints similares
   - Agrupa endpoints relacionados en el mismo router

2. **Para integraci√≥n con frontend:**

   - Revisa qu√© rutas frontend consumir√°n tu API
   - Aseg√∫rate de que los schemas sean claros y completos
   - Considera los casos de error y valida las respuestas

3. **Mantenimiento:**
   - Actualiza la documentaci√≥n cuando cambies endpoints
   - Ejecuta el script de generaci√≥n despu√©s de cambios importantes

### Para DevOps y QA

1. **Validaci√≥n de integraci√≥n:**

   - Usa los enlaces directos para probar cada componente
   - Verifica que los endpoints respondan correctamente
   - Valida que la documentaci√≥n est√© actualizada

2. **Automatizaci√≥n:**
   - El script `generate-api-docs.sh` debe ejecutarse en CI/CD
   - Los enlaces deben validarse autom√°ticamente
   - La documentaci√≥n debe regenerarse con cada deployment

## üîÑ Automatizaci√≥n

### Regenerar Documentaci√≥n

```bash
# M√©todo 1: Script directo
./scripts/generate-api-docs.sh

# M√©todo 2: Comando npm/pnpm
pnpm docs:generate-api

# M√©todo 3: Como parte del workflow de desarrollo
pnpm dev:docs  # Incluye regeneraci√≥n autom√°tica
```

### Configuraci√≥n de CI/CD

Para mantener la documentaci√≥n siempre actualizada, agrega esto a tu pipeline:

```yaml
# .github/workflows/docs.yml
- name: Generate API Documentation
  run: |
    ./scripts/generate-api-docs.sh
    git add docs/development/generated-api-integration.md
    git commit -m "docs: update API integration mapping" || true
```

## üìã Convenciones

### Nomenclatura de Stories

```typescript
// ‚úÖ Correcto
export default {
  title: 'Components/Forms/LoginForm',
  component: LoginForm,
};

// ‚ùå Evitar
export default {
  title: 'login-form',
  component: LoginForm,
};
```

### Documentaci√≥n de Endpoints

```python
# ‚úÖ Correcto
@router.get("/business-licenses/",
    summary="List business licenses",
    description="Retrieve a paginated list of business licenses with optional filtering",
    response_model=BusinessLicenseResponse
)

# ‚ùå Evitar
@router.get("/licenses/")  # Sin documentaci√≥n
```

### Estructura de Rutas

```typescript
// ‚úÖ Correcto - archivo: routes/licenses.tsx
export default function LicensesRoute() {
  // Importar componentes espec√≠ficos de Storybook
  // Usar endpoints documentados en Swagger
}

// ‚ùå Evitar - l√≥gica compleja sin componentizaci√≥n
```

## üé® Patrones de Dise√±o

### Componentes Base

| Componente | Uso                 | Storybook                                                                         |
| ---------- | ------------------- | --------------------------------------------------------------------------------- |
| `Button`   | Todas las acciones  | [Ver en Storybook](http://localhost:6006/?path=/story/components-button--default) |
| `Input`    | Formularios         | [Ver en Storybook](http://localhost:6006/?path=/story/components-input--default)  |
| `Table`    | Listados de datos   | [Ver en Storybook](http://localhost:6006/?path=/story/components-table--default)  |
| `Modal`    | Ventanas emergentes | [Ver en Storybook](http://localhost:6006/?path=/story/components-modal--default)  |

### Patrones de API

| Patr√≥n     | Endpoint                   | Descripci√≥n           |
| ---------- | -------------------------- | --------------------- |
| Listado    | `GET /v1/resource/`        | Listar con paginaci√≥n |
| Detalle    | `GET /v1/resource/{id}`    | Obtener por ID        |
| Crear      | `POST /v1/resource/`       | Crear nuevo recurso   |
| Actualizar | `PUT /v1/resource/{id}`    | Actualizar existente  |
| Eliminar   | `DELETE /v1/resource/{id}` | Eliminar recurso      |

## üîç B√∫squeda y Navegaci√≥n

### Encontrar Componentes

1. **Por funcionalidad:** Usa la b√∫squeda en la tabla interactiva arriba
2. **Por categor√≠a:** Navega directamente en Storybook por carpetas
3. **Por ruta:** Encuentra qu√© componentes usa cada p√°gina

### Encontrar Endpoints

1. **Por router:** Usa la documentaci√≥n generada autom√°ticamente
2. **Por funcionalidad:** Busca en Swagger por tags y operaciones
3. **Por ruta frontend:** Consulta la tabla de integraci√≥n

## üìö Recursos Adicionales

- [Documentaci√≥n Generada Autom√°ticamente](./generated-api-integration) - Mapeo completo actualizado
- [README de Desarrollo](/development/) - Gu√≠a para contribuidores
- [Arquitectura del Proyecto](../getting-started/overview) - Visi√≥n general del sistema

## ü§ù Contribuir

1. **A√±adir nuevos componentes:** Crea el story correspondiente en Storybook
2. **Nuevos endpoints:** Documenta en Swagger y ejecuta el script de generaci√≥n
3. **Nuevas rutas:** Aseg√∫rate de mapear componentes y APIs utilizados
4. **Mejoras:** Sugiere mejoras a esta documentaci√≥n o al script de automatizaci√≥n

---

> üí° **Tip:** Esta documentaci√≥n es un punto de partida. El mapeo exacto y actualizado siempre estar√° en la [documentaci√≥n generada autom√°ticamente](./generated-api-integration).

- **Componentes Storybook:**
  - [License Table](http://localhost:6006/?path=/story/tables-license--issued)
  - [Status Badge](http://localhost:6006/?path=/story/components-badge--status)
  - [Download Button](http://localhost:6006/?path=/story/buttons-download--pdf)
- **Endpoints API:**
  - `GET /v1/business-licenses/issued` - Licencias emitidas
  - `GET /v1/business-licenses/{id}/pdf` - Descargar PDF
  - `GET /v1/business-licenses/{id}/receipt` - Descargar recibo

### ‚úÖ Aprobaciones de Procedimientos

**Ruta:** `/procedure-approvals`

- **Componente Principal:** `routes/procedure-approvals.tsx`
- **Componentes Storybook:**
  - [Approval Table](http://localhost:6006/?path=/story/tables-approval--procedures)
  - [Approval Modal](http://localhost:6006/?path=/story/modals-approval--default)
  - [Status Timeline](http://localhost:6006/?path=/story/components-timeline--status)
- **Endpoints API:**
  - `GET /v1/procedures/` - Listar procedimientos
  - `POST /v1/procedures/{id}/approve` - Aprobar procedimiento
  - `POST /v1/procedures/{id}/reject` - Rechazar procedimiento
  - `GET /v1/procedures/{id}/history` - Historial de cambios

### üîî Notificaciones

**Ruta:** `/notifications`

- **Componente Principal:** `routes/notifications.tsx`
- **Componentes Storybook:**
  - [Notification List](http://localhost:6006/?path=/story/components-notification--list)
  - [Notification Item](http://localhost:6006/?path=/story/components-notification--item)
  - [Notification Badge](http://localhost:6006/?path=/story/components-notification--badge)
- **Endpoints API:**
  - `GET /v1/notifications/` - Listar notificaciones
  - `POST /v1/notifications/{id}/mark-read` - Marcar como le√≠da
  - `POST /v1/notifications/mark-all-read` - Marcar todas como le√≠das

### üîê Autenticaci√≥n

**Rutas:** `/login`, `/register`, `/forgot`, `/logout`

- **Componentes Principales:**
  - `routes/login.tsx`
  - `routes/register.tsx`
  - `routes/forgot.tsx`
  - `routes/logout.tsx`
- **Componentes Storybook:**
  - [Login Form](http://localhost:6006/?path=/story/forms-auth--login)
  - [Register Form](http://localhost:6006/?path=/story/forms-auth--register)
  - [Button Component](http://localhost:6006/?path=/story/components-button--primary)
- **Endpoints API:**
  - `POST /v1/auth/token` - Iniciar sesi√≥n
  - `POST /v1/auth/register` - Registrar usuario
  - `POST /v1/auth/forgot-password` - Recuperar contrase√±a
  - `POST /v1/auth/logout` - Cerrar sesi√≥n

### üìÑ Hojas T√©cnicas y PDFs

**Rutas:** `/technical-sheet`, `/requirements-pdf`

- **Componentes Principales:**
  - `routes/technical-sheet.tsx`
  - `routes/requirements-pdf.tsx`
- **Componentes Storybook:**
  - [PDF Viewer](http://localhost:6006/?path=/story/components-pdf--viewer)
  - [Document Form](http://localhost:6006/?path=/story/forms-document--technical)
- **Endpoints API:**
  - `GET /v1/documents/technical-sheet/{id}` - Obtener hoja t√©cnica
  - `GET /v1/documents/requirements/{id}` - Obtener requisitos PDF
  - `POST /v1/documents/generate` - Generar documento

### ‚ÑπÔ∏è Informaci√≥n

**Ruta:** `/about`

- **Componente Principal:** `routes/about.tsx`
- **Componentes Storybook:**
  - [About Section](http://localhost:6006/?path=/story/components-about--section)
  - [Feature Cards](http://localhost:6006/?path=/story/components-feature--cards)

## üîß Configuraci√≥n de Desarrollo

### Storybook (Puerto 6006)

```bash
# Iniciar Storybook
cd apps/frontend
pnpm run storybook

# Construir Storybook est√°tico
pnpm run build-storybook
```

### Swagger API (Puerto 8000)

```bash
# Iniciar backend FastAPI
cd apps/backend
uvicorn app.main:app --reload --port 8000

# Acceder a documentaci√≥n
# http://localhost:8000/docs (Swagger UI)
# http://localhost:8000/redoc (ReDoc)
```

## üìö Convenciones

### Nomenclatura de Stories

- **Componentes:** `ComponentName.stories.tsx`
- **Path:** `/story/category-componentname--variant`
- **Categor√≠as:** `components`, `forms`, `modals`, `tables`, `buttons`

### Endpoints API

- **Versioning:** `/v1/`
- **RESTful:** `GET`, `POST`, `PUT`, `DELETE`
- **Autenticaci√≥n:** Bearer Token en headers
- **Documentaci√≥n:** Autom√°tica con FastAPI + Swagger

## üöÄ Pr√≥ximos Pasos

1. **Automatizaci√≥n:** Script para generar esta documentaci√≥n autom√°ticamente
2. **E2E Testing:** Integrar Playwright con Storybook y API
3. **Deployment:** URLs de producci√≥n para Storybook y API docs
4. **Monitoreo:** Health checks y m√©tricas de performance

---

> üí° **Tip:** Esta documentaci√≥n se actualiza autom√°ticamente cuando se agregan nuevas rutas, componentes o endpoints al proyecto.
